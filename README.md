## Project: Real-Time Appearance-Based Mapping 

This project uses the [ROS RTAB-Map](http://wiki.ros.org/rtabmap_ros) package in conjunction with a simplified [Spherebot](https://github.com/ajdonich/spherebot) to generate 2D occupancy grids and 3D octomaps of a feature rich Gazebo world simulation. My raw mapping results are not included in the repo due to size, but can be accessed here: [rtabmap.db](https://drive.google.com/file/d/192qhcvObWA0YEF3vVoobDNf0qe4kX5KN/view?usp=sharing). Below are some images of my Gazebo test environment, rtabmap.db opened in [RTAB-Map Database Viewer](https://github.com/introlab/rtabmap/wiki/Tools), and generated 2D and 3D maps. 

![testscreens](https://github.com/ajdonich/rtab-mapping/blob/main/testscreens.jpg)
![mappings](https://github.com/ajdonich/rtab-mapping/blob/main/mappings.jpg)

___

### Installation and Build:

Note: the project requires both [ROS](http://wiki.ros.org/ROS/Installation) and [Gazebo](http://gazebosim.org/) to be appropriately installed (including PATH access to respective binaries) on the client machine. The project was developed on a Ubuntu system with Gazebo v7.16.0 and a ROS Kinetic Kame distro (neither of which are the most recent, but they're what Udacity currently provides). To install and build:

```
$ git clone https://github.com/ajdonich/rtab-mapping.git
$ cd rtab-mapping/catkin_ws
$ catkin_make
```

This build will generate two directories in *catkin_ws*: *build* and *devel*. Before executing ROS commands to launch the simulation from a terminal, you will need to source the ros/catkin setup file (in each terminal window you use, and you will need at least three):
```
$ source devel/setup.bash
```
**Note:** execution of commands described below from a terminal that does not have this environment sourced will likely produce cryptic errors, and because ROS setup is required in every new terminal, you may prefer to automate this step by adding something like the following to your *.bash_profile* (or similar):

``` bash
ROS_SETUP=/home/workspace/rtab-mapping/catkin_ws/devel/setup.bash
if test -f "$ROS_SETUP"; then
    echo "Catkin workspace found, sourcing setup file:"
    echo "${ROS_SETUP}"
    cd /home/workspace/rtab-mapping/catkin_ws
    source devel/setup.bash
    echo ""
fi
```
___

### Execution:

To run the simulation, start three terminal windows and execute the following three commands in them respectively. The first launches Gazebo, ROS Core and Spherebot and should complete with the Gazebo client GUI displaying Spherebot within his world. The second launches RTAB-Map and RViz Nodes. The third launches a [ROS Teleop Node](https://github.com/ros-teleop/teleop_twist_keyboard) (not included in repo) to drive Spherebot via the keyboard.

```
$ roslaunch spherebot spherebot_spawn.launch
```
```
$ roslaunch spherebot mapping.launch
```
```
$ rosrun teleop_twist_keyboard teleop_twist_keyboard.py
```

Next, use Teleop keyboard commands to drive Spherebot around the environment (slow speeds suggested). (Desired) loop-closings are easily generated by driving cyclically along previously travelled trajectory paths, however (**Trouble Shooting**) despite a significant quantity of distinctive features in the environment, the spiral nature of my particular world can still trigger erroneous loop-closings if you are not careful because similar/ambiguous angular perspectives can be perceived by Spherebot even though he is actually in significantly distinct regions of the world. If this happens, the mapping error will be significant and restarting the test is the only real option. The trajectory pattern I used in the screenshots above takes care to avoid the particular location of ambiguity in the spiral.  

___  
  
### Implementation Notes:

Spherebot's slightly altered specification (to include an [RGBD Kinect Camera](http://gazebosim.org/tutorials/?tut=ros_depth_camera)) can be found in [spherebot.xacro](https://github.com/ajdonich/rtab-mapping/blob/main/catkin_ws/src/spherebot/urdf/spherebot.xacro) and [spherebot.gazebo](https://github.com/ajdonich/rtab-mapping/blob/main/catkin_ws/src/spherebot/urdf/spherebot.gazebo). For his more complete implementation, see the [Spherebot Repo](https://github.com/ajdonich/spherebot). The [occgrid_2d.png](https://github.com/ajdonich/rtab-mapping/blob/main/catkin_ws/src/spherebot/maps/occgrid_2d.png) and [octomap_3d.png](https://github.com/ajdonich/rtab-mapping/blob/main/catkin_ws/src/spherebot/maps/octomap_3d.png) maps were generated by RTAB-Map, exported from RTAB-Map Database Viewer, and post-processed (slight color amplification and image rotation) in Photoshop.
